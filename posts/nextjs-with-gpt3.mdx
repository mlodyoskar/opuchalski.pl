---
title: Tworzenie pomysÅ‚Ã³w na aplikacje z uÅ¼yciem GPT-3 i Next.js
description: Wykorzystanie GPT-3 oraz Next.js do generowania kreatywnych pomysÅ‚Ã³w na aplikacjÄ™.
date: '2023-01-31'
image: '/images/nextjs-with-gpt3/nextjs-with-gpt3.jpg'
category: 'React'
featured: true
---

## Tworzenie pomysÅ‚Ã³w na aplikacjÄ™

CzÄ™sto na grupach facebook'owych czy na kanaÅ‚ach Discord widzÄ™ pytania typu _"JakÄ… aplikacjÄ™ napisaÄ‡ w React"_.

Z racji, Å¼e ostatnio testowaÅ‚em trochÄ™ GPT-3, wpadÅ‚em na pomysÅ‚, Å¼e napiszÄ™ aplikacjÄ™, ktÃ³ra na podstawie podanych parametrÃ³w, wygeneruje pomysÅ‚ na aplikacjÄ™!

## Czym jest GPT-3?

Zanim jednak przejdziemy do samego kodu pogadajmy o teorii.

ZakÅ‚adam Å¼e wiesz czym jest Next.js, ale przybliÅ¼Ä™ Ci w skrÃ³cie czym jest "nowoÅ›Ä‡" od OpenAI.

GPT-3 (Generative Pre-trained Transformer 3) to jeden z najwiÄ™kszych modeli jÄ™zykowych stworzonych przez OpenAI, posiadajÄ…cy 175 miliardÃ³w parametrÃ³w. Jest on w stanie generowaÄ‡ naturalny jÄ™zyk na rÃ³Å¼ne tematy, a takÅ¼e rozwiÄ…zywaÄ‡ rÃ³Å¼ne zadania jÄ™zykowe, takie jak tÅ‚umaczenie, generowanie opisÃ³w, rozumienie pytaÅ„ i odpowiedzi itp. (wygenerowane przez ChatGPT)

Tutaj przykÅ‚adowe pytanie i odpowiedÅº:

Pytanie: **"Jakie zwierzÄ™ta mieszkajÄ… w Afryce?"**

OdpowiedÅº: **"W Afryce moÅ¼na spotkaÄ‡ wiele rÃ³Å¼nych zwierzÄ…t, takich jak: sÅ‚onie, lwy, gepardy, antylopy, nosoroÅ¼ce, bawoÅ‚y, hipopotamy, zebrÄ™, krokodyle, flamingi, i wiele innych."**

## PrzykÅ‚ad wykorzystania GPT-3

Pora na przejÅ›cie do miÄ™sa, czyli wykorzystanie GPT-3 na froncie poprzez spiÄ™cie naszego frontu z API wystawianym przez OpenAI.

W naszym przypadku skorzystamy z udostÄ™pnionej przez nich biblioteki, poniewaÅ¼ jest napisana w 100% w TypeScriptcie, co zapewni nam autouzupeÅ‚nianie i bezpieczeÅ„stwo typÃ³w.

### Setup projektu

Setup zaczniemy od postawienia aplikacji reactowej w oparciu o framework Next.js. NastÄ™pnie zainstalujemy paczkÄ™ o nazwie `openai`

Ja wykorzystam do tego `pnpm`, ale moÅ¼esz uÅ¼yÄ‡ dowolnego menedÅ¼era pakietÃ³w (np. `npm` czy `yarn`)

```bash
pnpm create next-app nextjs-with-openai
cd nextjs-with-openai
pnpm install openai
pnpm run dev
```

Mamy juÅ¼ zainicjalizowany projekt oraz zainstalowane potrzebne paczki, przejdÅºmy do sedna.

### Strona do tworzenia zapytaÅ„ i wyÅ›wietlania wynikÃ³w

Zaczniemy od strony frontu, gdzie stworzymy formularz, do ktÃ³rego bÄ™dziemy wprowadzaÄ‡ wartoÅ›ci do formularza oraz pokazywaÄ‡ wyniki. Nie bÄ™dÄ™ siÄ™ skupiaÅ‚ teraz na wyglÄ…dzie aplikacji, ale w wersji demo bÄ™dÄ… one zawarte.

Tak wyglÄ…da przygotowana strona z formularzem i miejscem do wyÅ›wietlania wynikÃ³w:

```tsx:pages/index.tsx
import React, { useState } from 'react'

export default function Home() {
  const [interests, setInterests] = useState('')
  const [results, setResults] = useState('')

  const onSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    ...tutaj zapytanie do naszego API Route
  }

  return (
    <main>
      <form onSubmit={onSubmit}>
        <label>
          Twoje zainteresowania
          <input
            name="interests"
            onChange={(e) => setInterests(e.currentTarget.value)}
          />
        </label>
        <button>WyÅ›lij</button>
      </form>
      <p>{results}</p>
    </main>
  )
}
```

### API Route do obsÅ‚ugi zapytaÅ„

Teraz pora stworzyÄ‡ nasz API Route, do ktÃ³rego bÄ™dzie wysyÅ‚aÄ‡ zapytania, na podstawie ktÃ³rych bÄ™dziemy dostawali odpowiedzi z API OpenAI.

Ale moÅ¼e, zanim przejdziemy bezpoÅ›rednio do tego odpowiedzmy na pytanie czemu nie bÄ™dziemy wykonywaÄ‡ tych zapytaÅ„ po stronie frontu, przecieÅ¼ moglibyÅ›my!

MyÅ›lÄ™, Å¼e jednÄ… z najwaÅ¼niejszych rzeczy jest fakt, Å¼e do wykonywania requestÃ³w do API GPT-3 potrzebny nam jest token, a wykonujÄ…c nasze requesty z frontu, kaÅ¼dy mÃ³gÅ‚by przeczytaÄ‡ nasz token i wykorzystaÄ‡ go do wykonywania zapytaÅ„.

MoglibyÅ›my pomyÅ›leÄ‡, Å¼e to nic wielkiego, ale iloÅ›Ä‡ bezpÅ‚atnych zapytaÅ„ jest limitowana, takÅ¼e warto go ukryÄ‡.

Tak moÅ¼e wyglÄ…daÄ‡ nasz przykÅ‚adowy API Route:

```ts:pages/api/generate-idea.ts
import type { NextApiHandler } from "next";
import { Configuration, OpenAIApi } from "openai";

const OPENAI_API_KEY = process.env.OPENAI_API_KEY;

if (!OPENAI_API_KEY) {
 throw new Error("Nie podano zmiennej Å›rodowiskowej OPENAI_API_KEY");
}

const configuration = new Configuration({
 apiKey: OPENAI_API_KEY,
});

const openai = new OpenAIApi(configuration);


const handler: NextApiHandler = async (req, res) => {
 if (req.method !== "POST") {
  res.status(405).json({ error: "Method not allowed" });
 }

 const completion = await openai.createCompletion({
  model: "text-davinci-003",
  prompt: ...tu bÄ™dzie nasze zapytanie do GPT-3,,
  temperature: 0.9,
  max_tokens: 500,
 });

 res.status(200).json({ result: ...tu bÄ™dziemy zwracaÄ‡ dane });
};

export default handler;

```

PrzejdÅºmy sobie krok po kroku co tu siÄ™ dzieje.

Najpierw importujemy dwie klasy z biblioteki `openai`, ktÃ³re sÅ‚uÅ¼Ä… nam do stworzenia konfiguracji oraz do zainicjalizowania obiektu, ktÃ³ry dostarczy nam metody do wspÃ³Å‚pracy z GPT-3.

Dalej odczytujemy zmiennÄ… Å›rodowsikowÄ… o nazwie `OPENAI_API_KEY`, to wÅ‚aÅ›nie nasz klucz dziÄ™ki ktÃ³remu moÅ¼emy wykonywaÄ‡ zapytania.
Trzymamy go jako zmiennÄ…, aby nie moÅ¼na byÅ‚o jej odczytaÄ‡ w kodzie, oraz majÄ…c w gÅ‚owie, Å¼e jest to wartoÅ›Ä‡, ktÃ³ra moÅ¼e zmieniaÄ‡ siÄ™ w zaleÅ¼noÅ›ci od Å›rodowiska.

Dalej sprawdzamy, czy takowa zmienna Å›rodowiskowa w ogÃ³le zostaÅ‚a ustawiona, w innym przypadku wyrzucamy bÅ‚Ä…d. W ten sposÃ³b szybko dowiemy siÄ™ o tym, Å¼e zapomnieliÅ›my jÄ… ustawiÄ‡.

NastÄ™pnie tworzymy obiekt z konfiguracjÄ…, do ktÃ³rego przekazujemy nasz klucz oraz obiekt, ktÃ³ry dostarcza nam potrzebne metody, my wykorzystamy akurat tylko jednÄ…: `createCompletion`

NajwyÅ¼sza pora na napisanie handlera i tego, co siÄ™ w nim dzieje.

```ts
const completion = await openai.createCompletion({
  model: "text-davinci-003",
  prompt: ... tu bÄ™dzie nasze zapytanie do GPT-3,
  temperature: 0.9,
  max_tokens: 500,
 });
```

WywoÅ‚ujemy metodÄ™ `createCompletion`, do ktÃ³rej przekazujemy obiekt z opcjami. Wybieramy model o nazwie **_text-davinci-003_**,
jest to najmocniejszy model, ale jest teÅ¼ najdroÅ¼szy.

Ustawiamy parametr `temperature` na wartoÅ›Ä‡ 0.9.
Od tego zaleÅ¼y jak "kreatywna" i losowa bÄ™dzie odpowiedÅº modelu. Jak nazwa wskazuje `max_tokens` to maksymalna
iloÅ›Ä‡ tokenÃ³w, jaka moÅ¼e zostaÄ‡ "zapÅ‚acona" w ramach jednego requesta.

SprawdziÅ‚em, czy model **_text-curie-001_**, czyli o jeden rzÄ…d sÅ‚abszy sobie poradzi, niestety, zamiast podaÄ‡ pomysÅ‚ na aplikacjÄ™,
postanowiÅ‚ Å¼e opisze juÅ¼ istniejÄ…cÄ….
WiÄ™cej o modelach i ich cenach moÅ¼esz przeczytaÄ‡ [tutaj](https://openai.com/api/pricing/).

Na samym koÅ„cu zwracamy odpowiedÅº z kodem 200, oraz exportujemy handler.

### Generowanie prompta

NadszedÅ‚ czas na najwaÅ¼niejszÄ… czÄ™Å›Ä‡, czyli odpowiednie skomponowanie naszego **prompta**, czyli tekstu,
na podstawie ktÃ³rego GPT-3 bÄ™dzie generowaÄ‡ dla nas odpowiedzi. W naszym przypadku pomysÅ‚ na aplikacjÄ™ webowÄ…!

Metod na pisanie promptÃ³w jest sporo i w zaleÅ¼noÅ›ci jak je skonstruujemy moÅ¼emy otrzymaÄ‡ bardziej satysfakcjonujÄ…cÄ… odpowiedÅº lub mniej.
Dla nas najwaÅ¼niejsze jest, aby podaÄ‡ _szczegÃ³Å‚y_ odnoÅ›nie pomysÅ‚u na aplikacjÄ™, oraz _kontekst_. Na potrzeby tego wpisu zaÅ‚oÅ¼Ä™ Å¼e pomysÅ‚ na aplikacjÄ™ jest dla osoby poczÄ…tkujÄ…cej.

Istnieje wiele metod tworzenia promptÃ³w, a jakoÅ›Ä‡ otrzymanej odpowiedzi zaleÅ¼y od ich konstrukcji.
Dla nas najwaÅ¼niejsze jest, aby podaÄ‡ szczegÃ³Å‚y dotyczÄ…ce pomysÅ‚u na aplikacjÄ™ oraz kontekst.

Z pomocÄ… GPT-3 wymyÅ›liÅ‚em taki prompt (tak, GPT-3 Å›wietnie generuje prompty):

```
JesteÅ› poczÄ…tkujÄ…cym programistÄ… aplikacji webowych i masz
pomysÅ‚ na stworzenie aplikacji, ktÃ³ra odpowiada Twoim zainteresowaniom.
ProszÄ™ o opisanie tej aplikacji w maksymalnie 250 znakach,
uwzglÄ™dniajÄ…c jej gÅ‚Ã³wne funkcje i cel.
Twoje zainteresowania to ...zainteresowania z formularza.
```

Pierwsze zdanie peÅ‚ni rolÄ™ nadania kontekstu. Jak widzisz nadajemy naszemu modelowi osobowoÅ›Ä‡, przez co uzyskamy dokÅ‚adniejszÄ… odpowiedÅº.
NastÄ™pnie piszemy, co ma dla nas zrobiÄ‡ model, a na koÅ„cu podajemy nasze zainteresowania.

Mamy template promptu, stwÃ³rzmy prostÄ… funkcjÄ™, ktÃ³ra uzupeÅ‚ni ten template naszymi zainteresowanimi i uÅ¼yjmy jej do wygenerowania polecenia dla GPT-3.

Tak wyglÄ…da koÅ„cowa wersja naszego API Route.

```ts:pages/api/generate-idea.ts
import type { NextApiHandler } from "next";
import { Configuration, OpenAIApi } from "openai";

const OPENAI_API_KEY = process.env.OPENAI_API_KEY;

if (!OPENAI_API_KEY) {
 throw new Error("Nie podano zmiennej Å›rodowiskowej OPENAI_API_KEY");
}

const configuration = new Configuration({
 apiKey: OPENAI_API_KEY,
});

const openai = new OpenAIApi(configuration);

const generatePrompt = (interests: string) => {
 return `JesteÅ› poczÄ…tkujÄ…cym programistÄ… aplikacji webowych i masz
    pomysÅ‚ na stworzenie aplikacji, ktÃ³ra odpowiada Twoim zainteresowaniom.
    ProszÄ™ o opisanie tej aplikacji w maksymalnie 250 znakach,
    uwzglÄ™dniajÄ…c jej gÅ‚Ã³wne funkcje i cel.
    Twoje zainteresowania to ${interests}.`;
};

const handler: NextApiHandler = async (req, res) => {
 const prompt = generatePrompt(req.body.interests);

 const completion = await openai.createCompletion({
  model: "text-davinci-003",
  prompt: prompt,
  temperature: 0.9,
  max_tokens: 500,
 });

 res.status(200).json({ result: completion.data.choices[0].text });
};

export default handler;

```

MoÅ¼emy teraz wrÃ³ciÄ‡ na front i wysÅ‚aÄ‡ na nasz endpoint zapytanie o pomysÅ‚ na aplikacjÄ™!

### WysyÅ‚anie requesta i wyÅ›wietlanie odpowiedzi

PozostaÅ‚o nam zmieniÄ‡ tylko to, co dzieje siÄ™ w funkcji `onSubmit`.

Tak wyglÄ…da teraz ta funkcja:

```ts
const onSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
  e.preventDefault();

  const res = await fetch('/api/generate-idea', {
    method: 'POST',
    body: JSON.stringify({ interests }),
    headers: { 'Content-Type': 'application/json' },
  });

  const data = await res.json();
  setResults(data.result);
};
```

Ponownie przejdÅºmy krok po kroku i zobaczmy co tu siÄ™ dziejÄ™.

Najpierw z pomocÄ… `e.preventDefault()` zapobiegamy domyÅ›lnemu zachowaniu wysyÅ‚ania formularza, w tym odÅ›wieÅ¼eniu strony.

NastÄ™pnie najwaÅ¼niejsza rzecz czyli z pomocÄ… `fetch` wysyÅ‚amy request metodÄ… `POST`,
w body wysyÅ‚amy string z naszymi zainteresowaniami z formularza
i na koÅ„cu ustawiamy `Content-Type`, tak aby nasz API Route wiedziaÅ‚, jak dane sparsowaÄ‡.

W tym momencie pozostaÅ‚a nam do zrobienia ostatnia rzecz. Musimy ustawiÄ‡ zmiennÄ… Å›rodowiskowÄ… z API_KEY do OpenAI.

Tworzymy zatem plik `env.local` w gÅ‚Ã³wnym katalogu i uzupeÅ‚niamy go naszym kluczem. SwÃ³j klucz moÅ¼esz utworzyÄ‡ [tutaj](https://platform.openai.com/account/api-keys).

```txt:env.local
OPENAI_API_KEY=sk-hzpBUmdH3m5...UzbOM56dJhQTO
```

## Efekty naszej pracy

NajwyÅ¼sza pora sprawdziÄ‡, czy otrzymamy wynik i czy bÄ™dzie on pasowaÅ‚ do naszych wymagaÅ„.

Wpisuje w takim razie w formularzu, Å¼e moim zainteresowaniem jest **wspinaczka**.

Wynik jaki otrzymaÅ‚em:

**"MojÄ… aplikacjÄ… bÄ™dzie strona do wspinaczki gÃ³rskiej,
pozwalajÄ…ca uÅ¼ytkownikom planowaÄ‡ wyprawy, przeglÄ…daÄ‡ trasy i podzieliÄ‡ siÄ™ relacjami ze swoich wypraw.
UÅ¼ytkownicy bÄ™dÄ… mogli wyszukiwaÄ‡ trasy, oceniaÄ‡ innych wspinaczy,
porÃ³wnywaÄ‡ swoje postÄ™py oraz uzyskaÄ‡ dostÄ™p do aktualnych prognoz pogody."**

MyÅ›lÄ™, Å¼e brzmi to caÅ‚kiem nieÅºle, sprÃ³bujmy czegoÅ› innego.

Teraz podaÅ‚em, Å¼e moimi zainteresowaniami sÄ… **koszykÃ³wka** i **podcasty**.
ZauwaÅ¼, Å¼e podcasty to bardzo ogÃ³lna rzecz, mimo to, odpowiedÅº uwaÅ¼am za satysfakcjonujÄ…ca:

**"Moja aplikacja mobilna â€Koszâ€ to idealne narzÄ™dzie dla pasjonatÃ³w koszykÃ³wki.
Zawiera statystyki, wywiady z liderami zespoÅ‚u,
podcasty z najnowszymi wiadomoÅ›ciami dotyczÄ…cymi koszykÃ³wki,
jak rÃ³wnieÅ¼ elementy spoÅ‚ecznoÅ›ciowe pozwalajÄ…ce uÅ¼ytkownikom na dzielenie siÄ™ swojÄ… pasjÄ….
"**

Jedyne co to nazwa dla aplikacji moim zdaniem nie jest zbyt trafna ğŸ—‘ï¸.

## Podsumowanie

Mam nadziejÄ™, Å¼e zainspirowaÅ‚em CiÄ™ do prÃ³by wykorzystania GPT-3 w Twoim nastÄ™pnym projekcie.
Takie "kreatywne" generowanie treÅ›ci to tylko bardzo maÅ‚a czÄ™Å›Ä‡ moÅ¼liwoÅ›ci tego narzÄ™dzia,
jeÅ›li chcesz sprawdziÄ‡ co jeszcze potrafi zajrzyj [tutaj](https://platform.openai.com/examples/).

Kod ÅºrÃ³dÅ‚owy z tego posta znajdziesz na [GitHubie](https://github.com/mlodyoskar/nextjs-with-gpt3).
